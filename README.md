# Умное твердотельное реле с анализом ШИМ

### Ссылки
- [Обсуждение в теме форума UNI](https://uni3d.store/viewtopic.php?t=527)
- [Как залить Sketch в Arduino?](https://alexgyver.ru/arduino-first)

### Описание проблемы
Твердотельное реле Zero-Cross в процессе работы пропустит только те полупериоды синусоидального напряжения питания, начало которых совпадёт с импульсами сигнала ШИМ от платы управления. В результате твердотельное реле может находится в трёх состояниях: закрыто, открыто и открыто для одного полупериода. Так как между сетевым напряжением и управляющим сигналом ШИМ всегда будет "плавающая" рассинхронизация, можно говорить лишь о вероятности одного из этих состояний.

Например, при частоте питающего напряжения равной частоте ШИМ сигнала управления (50 Гц) и коэффициенте заполнения сигнала управления отличным от 1.0, можно говорить лишь о вероятности одного из трех состояний твердотельного реле.
- Коэффициент заполнения = 1.0 - полная мощность
- Коэффициент заполнения ≥ 0.5 - половина или полная мощность
- Коэффициент заполнения < 0.5 - 0 или половина мощности

<img src="https://github.com/demonlibra/smart_ssr/blob/master/oscilloscope/1.jpg" width="200"> <img src="https://github.com/demonlibra/smart_ssr/blob/master/oscilloscope/2.jpg" width="200"> <img src="https://github.com/demonlibra/smart_ssr/blob/master/oscilloscope/3.jpg" width="200"> <img src="https://github.com/demonlibra/smart_ssr/blob/master/oscilloscope/4.jpg" width="200">

Снимки 1 и 2 - Коэффициент заполнения ШИМ управляющего сигнала (синий) одинаковый, но мощность на выходе (жёлтый) будет отличаться в два раза.  
Снимки 2 и 3 - Коэффициент заполнения отличается в 4 раза, но мощность одинаковая.  
Снимки 3 и 4 - Коэффициент заполнения одинаковый, но мощность разная.  

Несоответствие коэффициента заполнения ШИМ сигнала управления и выходной мощности может быть причиной больших отклонений температуры от заданной. 
Решить описанную проблему может следующее решение:

<img src="https://github.com/demonlibra/smart_ssr/blob/master/arduino/smart_ssr_arduino.jpg" width="400"> <img src="https://github.com/demonlibra/smart_ssr/blob/master/digispark/smart_ssr_digispark.jpg" width="400">

### Комплектующие
- Arduino или digispark
- [Димер от Robotdyn](https://robotdyn.aliexpress.ru/store/1950989/search?origin=n&SortType=new_desc&SearchText=dimmer)

### Принцип работы
1. Сигнал управления поступает на вход Arduino, которая определяет длительность импульсов включения и коэффициент заполнения ШИМ.
2. Димер подаёт на Arduino сигналы перехода синусоиды напряжения через 0 для определения моментов времени открытия симистора. Таким образом достигается синхронизация сигнала управления и сетевого напряжения.
3. Сетевое напряжение с частотой 50 Гц имеет 100 полупериодов за одну секунду. Arduino выдаёт сигналы управления на димер для получения необходимой мощности, пропуская в единицу времени часть полупериодов сетевого напряжения. Таким образом достигается дискретность задания мощности 1%. Например, если за секунду пропустить только 20 полупериодов, будет получено 20% мощности.

<img src="https://github.com/demonlibra/smart_ssr/blob/master/oscilloscope/5.jpg" width="400">

Данное решение позволяет устранить проблемы неадекватной работы нагревателя с обычным твердотельным реле:
- Устранить проблему невозможности автоматической калибровки параметров ПИД.
- Обеспечить более точное поддержание температуры.
- Задать ограничение мощности. Может быть актуально для мощных грелок, если стол искривляется от быстрого нагрева.

### Важно
У большинства всё работает и без этого велосипеда. Не торопитесь реализовывать данную схему.
В большинстве случаев проблема управления твердотельным реле решается понижением частоты ШИМ меньше 10 Гц.
